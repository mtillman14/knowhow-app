<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a Team - KnowHow</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="form-container">
        <div id="form-step" class="form-step">
            <h1>Get started</h1>
            <p class="subtitle">Create your team and start collaborating</p>

            <div class="form-group">
                <label>Team name</label>
                <input type="text" id="teamName" placeholder="e.g. Engineering Team" required>
            </div>

            <div class="form-group">
                <label>Team URL</label>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="color: #6a737c;">knowhow.app/c/</span>
                    <input type="text" id="teamSlug" placeholder="engineering-team" required style="flex: 1;">
                </div>
            </div>

            <div style="display: flex; gap: 16px;">
                <div class="form-group" style="flex: 1;">
                    <label>First name</label>
                    <input type="text" id="firstName" required>
                </div>

                <div class="form-group" style="flex: 1;">
                    <label>Last name</label>
                    <input type="text" id="lastName" required>
                </div>
            </div>

            <div class="form-group">
                <label>Work email</label>
                <input type="email" id="email" placeholder="name@company.com" required>
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password" placeholder="At least 6 characters" required minlength="6">
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: flex-start; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="agreeTerms" required style="margin-top: 4px;">
                    <span>I agree to the KnowHow Terms of Service and Privacy Policy.</span>
                </label>
            </div>

            <button onclick="createTeam()" class="btn btn-primary" style="width: 100%;">Create team</button>

            <p style="text-align: center; margin-top: 16px; color: #6a737c;">
                Already have an account? <a href="/login.html" style="color: #0077cc;">Sign in</a>
            </p>
        </div>

        <!-- Loading -->
        <div id="loading" style="display: none;" class="text-center">
            <div class="loading">
                <div class="loading-icon"></div>
                <h2>Setting up KnowHow</h2>
                <p>We'll redirect you there in a few seconds.</p>
            </div>
        </div>

        <div id="error" class="error" style="display: none; margin-top: 16px;"></div>
    </div>

    <script src="/js/app.js"></script>
    <script>
        // Auto-generate slug from team name
        document.getElementById('teamName').addEventListener('input', (e) => {
            document.getElementById('teamSlug').value = e.target.value
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');
        });

        async function createTeam() {
            const error = document.getElementById('error');
            error.style.display = 'none';

            // Get form values
            const teamName = document.getElementById('teamName').value.trim();
            const teamSlug = document.getElementById('teamSlug').value.trim();
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;

            // Validate
            if (!teamName || !teamSlug || !firstName || !lastName || !email || !password) {
                error.textContent = 'Please fill in all fields';
                error.style.display = 'block';
                return;
            }

            if (!agreeTerms) {
                error.textContent = 'You must agree to the terms of service';
                error.style.display = 'block';
                return;
            }

            if (password.length < 6) {
                error.textContent = 'Password must be at least 6 characters';
                error.style.display = 'block';
                return;
            }

            // Show loading
            document.getElementById('form-step').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            try {
                // Register user
                await KnowHow.apiCall('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({
                        email,
                        password,
                        firstName,
                        lastName
                    })
                });

                // Create team
                await KnowHow.apiCall('/teams', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: teamName,
                        slug: teamSlug
                    })
                });

                // Redirect to team page
                setTimeout(() => {
                    window.location.href = `/team/${teamSlug}/questions`;
                }, 1500);
            } catch (err) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('form-step').style.display = 'block';
                error.textContent = err.message;
                error.style.display = 'block';
            }
        }
    </script>
</body>
</html>
